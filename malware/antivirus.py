import sys
import base64
from Cryptodome.Cipher import AES
import os
import re


def readall(filename, pattern):
    file = open(filename, "r")
    injected = file.readlines()

    lineFound = False
    theLine = None
    theString = ""
    for line in injected:
        if (pattern in line):
            lineFound = True
            theLine = line
            break
    if (lineFound == True):
        start = False
        for character in theLine:
            if (character == "("):
                start = True
            elif (character == ")"):
                break
            elif (start == True):
                theString = theString + character

    if (theString == ""):
        return None
    return theString


def check(filename):
    result = 0
    key = readall(filename, "key = base64.b64decode(\"")
    c1 = readall(filename, "c1 = base64.b64decode(\"")
    c2 = None

    if (c1 != None and key != None):
        theKey = base64.b64decode(key)
        encrypted = base64.b64decode(c1)
        cipher = AES.new(theKey, mode=AES.MODE_ECB)
        c2 = cipher.decrypt(encrypted).decode()

    else:
        file = open(filename, "r")
        c2 = file.read()

    file1 = open("payload1.py", "r")
    payload1 = file1.read()

    file2 = open("payload2.py", "r")
    payload2 = file2.read()

    if payload1 in c2:
        result = 1
    elif payload2 in c2:
        result = 2
    else:
        result = None

    return result


if __name__ == '__main__':
    check(sys.argv[1])